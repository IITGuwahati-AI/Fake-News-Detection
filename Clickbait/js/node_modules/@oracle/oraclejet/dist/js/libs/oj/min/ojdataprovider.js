/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
define(["ojs/ojcore","ojs/ojeventtarget"],function(t){"use strict";var r,e,n=t.GenericEvent;!function(t){!function(t){t.$co="$co",t.$eq="$eq",t.$ew="$ew",t.$pr="$pr",t.$gt="$gt",t.$ge="$ge",t.$lt="$lt",t.$le="$le",t.$ne="$ne",t.$regex="$regex",t.$sw="$sw"}(t.AttributeOperator||(t.AttributeOperator={}))}(r||(r={})),t.AttributeFilterOperator=r,t.AttributeFilterOperator.AttributeOperator=r.AttributeOperator,function(t){!function(t){t.$and="$and",t.$or="$or"}(t.CompoundOperator||(t.CompoundOperator={}))}(e||(e={})),t.CompoundFilterOperator=e,t.CompoundFilterOperator.CompoundOperator=e.CompoundOperator;var i=function(t){function r(e){var n={};return n[r._DETAIL]=e,t.call(this,"mutate",n)||this}return __extends(r,t),r._DETAIL="detail",r}(n);t.DataProviderMutationEvent=i,t.DataProviderMutationEvent=i;var a=function(t){function r(){return t.call(this,"refresh")||this}return __extends(r,t),r}(n);t.DataProviderRefreshEvent=a,t.DataProviderRefreshEvent=a,t.DataProvider=function(){};var o=function(){function t(){}return t.prototype.fetchByKeys=function(t){var r=0,e=this.getIterationLimit?this.getIterationLimit():-1,n={size:25},i=new Map,a=this.fetchFirst(n)[Symbol.asyncIterator]();return function t(n,i,a){return i.next().then(function(o){var f=o.value,s=f.data,u=f.metadata,p=u.map(function(t){return t.key}),l=!0;return n.keys.forEach(function(t){a.has(t)||p.map(function(r,e){r==t&&a.set(r,{metadata:u[e],data:s[e]})}),a.has(t)||(l=!1)}),r+=s.length,l||o.done?a:-1!=e&&r>=e?a:t(n,i,a)})}(t,a,i).then(function(r){var e=new Map;return r.forEach(function(t,r){var n=[t];e.set(r,n[0])}),{fetchParameters:t,results:e}})},t.prototype.containsKeys=function(t){return this.fetchByKeys(t).then(function(r){var e=new Set;return t.keys.forEach(function(t){null!=r.results.get(t)&&e.add(t)}),Promise.resolve({containsParameters:t,results:e})})},t.prototype.getCapability=function(t){if("fetchByKeys"==t)return{implementation:"iteration"};var r=null;if(!0!==this._ojSkipLastCapability){this._ojSkipLastCapability=!0;for(var e=1;this["_ojLastGetCapability"+e];)++e;for(--e;e>0&&!(r=this["_ojLastGetCapability"+e](t));e--);delete this._ojSkipLastCapability}return r},t.applyMixin=function(r){var e=r.prototype.getCapability;if([t].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(e){"constructor"!==e&&(r.prototype[e]=t.prototype[e])})}),e){for(var n=1;r.prototype["_ojLastGetCapability"+n];)++n;r.prototype["_ojLastGetCapability"+n]=e}},t}();t.FetchByKeysMixin=o,t.FetchByKeysMixin.applyMixin=o.applyMixin;var f=function(){function t(){}return t.prototype.fetchByOffset=function(t){var r=t&&t.size>0?t.size:25,e=t?t.sortCriteria:null,n=t&&t.offset>0?t.offset:0,i=0,a=this.getIterationLimit?this.getIterationLimit():-1,o=!1,f={};f.size=r,f.sortCriteria=e;var s=new Array,u=this.fetchFirst(f)[Symbol.asyncIterator]();return function t(e,f,s){return f.next().then(function(u){o=u.done;var p=u.value,l=p.data,c=p.metadata,h=l.length;if(n<i+h)for(var y=n<=i?0:n-i;y<h&&s.length!=r;y++)s.push({metadata:c[y],data:l[y]});return i+=h,s.length<r&&!o?-1!=a&&i>=a?s:t(e,f,s):s})}(t,u,s).then(function(r){return{fetchParameters:t,results:r,done:o}})},t.prototype.getCapability=function(t){if("fetchByOffset"==t)return{implementation:"iteration"};var r=null;if(!0!==this._ojSkipLastCapability){this._ojSkipLastCapability=!0;for(var e=1;this["_ojLastGetCapability"+e];)++e;for(--e;e>0&&!(r=this["_ojLastGetCapability"+e](t));e--);delete this._ojSkipLastCapability}return r},t.applyMixin=function(r){var e=r.prototype.getCapability;if([t].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(e){"constructor"!==e&&(r.prototype[e]=t.prototype[e])})}),e){for(var n=1;r.prototype["_ojLastGetCapability"+n];)++n;r.prototype["_ojLastGetCapability"+n]=e}},t}();t.FetchByOffsetMixin=f,t.FetchByOffsetMixin.applyMixin=f.applyMixin;var s=function(){function r(t){var r=t?t.filterDef:null;r&&(this.op=r.op),r.value?(this.value=r.value,r.attribute&&(this.attribute=r.attribute)):r&&(this.criteria=r.criteria)}return r.prototype.filter=function(e,n,i){return t.FilterUtils.satisfy(r._transformFilter(this),e)},r._transformFilter=function(t){var e;if(t){var n=t.op;if("$le"===n?n="$lte":"$ge"===n?n="$gte":"$pr"===n&&(n="$exists"),"$and"!=n&&"$or"!=n){var i=t.value;e={};var a=t.attribute;if(a){var o={};"$sw"!==n&&"$ew"!==n&&"$co"!==n||(n="$regex",i=r._fixStringExpr(n,i)),o[n]=i,e[a]=o}else{var f=[];r._transformObjectExpr(i,n,null,f),e.$and=f}}else{var s=[];t.criteria.forEach(function(t){s.push(r._transformFilter(t))}),(e={})[n]=s}}return e},r._transformObjectExpr=function(t,e,n,i){if(Object.keys(t).length>0)Object.keys(t).forEach(function(a){var o=t[a],f=n?n+"."+a:a;if(o instanceof Object)r._transformObjectExpr(o,e,f,i);else{var s={};"$sw"!==e&&"$ew"!==e&&"$co"!==e||(e="$regex",o=r._fixStringExpr(e,o)),s[e]=o;var u={};u[f]=s,i.push(u)}});else{var a={};a[e]=t;var o={};o[n]=a,i.push(o)}},r._fixStringExpr=function(t,r){return("string"==typeof r||r instanceof String)&&("$sw"===t?r="^"+r:"$ew"===t&&(r+="$")),r},r}(),u=function(){function t(){}return t.getFilter=function(t){return new s(t)},t}();t.FilterFactory=u,t.FilterUtils=function(){function t(t,r){var e=!1;for(var i in r)if(r.hasOwnProperty(i)){var a=r[i];if(e||!n(i))throw new Error("parsing error "+r);t.operator=i,t.right=a,e=!0}}function r(t,r,e){var n;if("$lt"===t)return(e=(n=a(e,r))[0])<(r=n[1]);if("$gt"===t)return(e=(n=a(e,r))[0])>(r=n[1]);if("$lte"===t)return(e=(n=a(e,r))[0])<=(r=n[1]);if("$gte"===t)return(e=(n=a(e,r))[0])>=(r=n[1]);if("$eq"===t)return e===r;if("$ne"===t)return e!==r;if("$regex"===t)return!!e&&("string"==typeof e||e instanceof String||(e=new String(e)),null!==e.match(r));if("$exists"===t)return r?null!=e:null==e;throw new Error("not a valid expression! "+expTree)}function e(t){return"$and"===t||"$or"===t}function n(t){return"$lt"===t||"$gt"===t||"$lte"===t||"$gte"===t||"$eq"===t||"$ne"===t||"$regex"===t||"$exists"===t}function i(t){return null!=t&&(t instanceof String||"string"==typeof t)}function a(t,r){return i(t)&&null==r?r="":i(r)&&null==t&&(t=""),[t,r]}function o(t,r){for(var e=t.split("."),n=r,i=0;i<e.length;i++)n=n[e[i]];return n}return{satisfy:function(i,a){return!i||function t(i,a){var f=i.operator;if(e(f)){if(!i.left&&i.array instanceof Array){for(var s,u=i.array,p=0;p<u.length;p++){var l=t(u[p],a);if("$or"===f&&!0===l)return!0;if("$and"===f&&!1===l)return!1;s=l}return s}throw new Error("invalid expression tree!"+i)}if(n(f)){var c,h=i.right;if("*"!=i.left)return c=o(i.left,a),r(f,h,c);var y,v=Object.keys(a);for(y=0;y<v.length;y++)if(c=o(v[y],a),r(f,h,c))return!0;return!1}throw new Error("not a valid expression!"+i)}(function r(i){var a,o=[];for(var f in i)if(i.hasOwnProperty(f)){var s=i[f];if(0===f.indexOf("$")){if(e(f)){if(!(s instanceof Array))throw new Error("not a valid expression: "+i);a={operator:f,array:[]};for(var u=0;u<s.length;u++){var p=r(s[u]);a.array.push(p)}}else if(n(f))throw new Error("not a valid expression: "+i)}else if("object"!=typeof s)o.push({left:f,right:s,operator:"$eq"});else{var l={left:f};t(l,s),o.push(l)}}return o.length>1?a={operator:"$and",array:o}:1===o.length&&(a=o[0]),a}(i),a)},getValue:o,assembleObject:function(t,r){var e;if(r){e={};for(var n=0;n<r.length;n++)for(var i=e,a=t,o=r[n].split("."),f=0;f<o.length;f++)a=a[o[f]],!i[o[f]]&&f<o.length-1&&(i[o[f]]={}),f===o.length-1?i[o[f]]=a:i=i[o[f]]}else e=t;return e}}}();var p={};return p.FetchByKeysMixin=t.FetchByKeysMixin,p.FetchByOffsetMixin=t.FetchByOffsetMixin,p.FilterFactory=t.FilterFactory,p});