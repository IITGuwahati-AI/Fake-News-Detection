/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
define(["ojs/ojcore","jquery","ojs/ojcontext","knockout","ojs/ojmessaging","ojs/ojknockout"],function(n,e,i,a,t){"use strict";n.InvalidComponentTracker=function(){this.Init()},n.Object.createSubclass(n.InvalidComponentTracker,n.Object,"oj.InvalidComponentTracker"),n.InvalidComponentTracker._OPTION_MESSAGES_SHOWN="messagesShown",n.InvalidComponentTracker._OPTION_MESSAGES_HIDDEN="messagesHidden",n.InvalidComponentTracker._OPTION_DISABLED="disabled",n.InvalidComponentTracker._OPTION_READONLY="readOnly",n.InvalidComponentTracker.prototype.Init=function(){n.InvalidComponentTracker.superclass.Init.call(this),this._tracked=[],this._invalid=[],this._invalidHidden=[],this.invalidShown=!1,this.invalidHidden=!1},n.InvalidComponentTracker.prototype.focusOnFirstInvalid=function(){var n=null,e=this,a=this._updateCounter,t=i.getPageContext().getBusyContext().addBusyState({description:"Setting Focus to first invalid component."});return this.invalidShown&&(n=this._getFirstInvalidComponent()),setTimeout(function(){(n=a===e._updateCounter&&n||e._getFirstInvalidComponent())&&n("instance").GetFocusElement().focus(),t()},1),!!n},n.InvalidComponentTracker.prototype.showMessages=function(){var n;if(this.invalidHidden)for(var e=this._invalidHidden.length,i=0;i<e;i++)this._invalidHidden[i]&&(n=this._tracked[i].component.call(n,"showMessages"))},n.InvalidComponentTracker.prototype._getFirstInvalidComponent=function(){var n=0,e=[],i=this._invalid.length;for(n=0;n<i;n++){this._invalid[n]&&e.push(this._tracked[n])}return 0===e.length?null:(e.sort(function(n,e){var i=n.element,a=e.element;return i.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}),e[0].component)},n.InvalidComponentTracker.prototype._remove=function(n){var i=-1,a=!1;return e.each(this._tracked,function(e,a){i<0&&a.component===n&&(i=e)}),i>=0&&(this._tracked.splice(i,1),this._invalid.splice(i,1),this._invalidHidden.splice(i,1),this._updateInvalidProperties(),a=!0),a},n.InvalidComponentTracker.prototype._update=function(i,a,t,o){var r,d=i.call(i,"isValid"),l=!0,_=-1;switch(e.each(this._tracked,function(n,e){_<0&&e.component===i&&(_=n)}),t){case n.InvalidComponentTracker._OPTION_MESSAGES_SHOWN:case n.InvalidComponentTracker._OPTION_MESSAGES_HIDDEN:if(r=!1,o){if(_<0&&(_=this._tracked.push({component:i,element:a})-1,this._initializeInvalidTrackers(_,r)),!d&&n.InvalidComponentTracker._hasInvalidMessages(o)&&(r=!0,t===n.InvalidComponentTracker._OPTION_MESSAGES_SHOWN)){var s=i.call(i,"option",n.InvalidComponentTracker._OPTION_DISABLED),u=i.call(i,"option",n.InvalidComponentTracker._OPTION_READONLY);r=!(s||u)}l=this._updateInvalidTracker(t,_||0,r),this._updateInvalidProperties(),l&&(void 0===this._updateCounter&&(this._updateCounter=0),this._updateCounter+=1)}break;case n.InvalidComponentTracker._OPTION_DISABLED:case n.InvalidComponentTracker._OPTION_READONLY:l=!1,o&&(l=this._updateInvalidTracker(n.InvalidComponentTracker._OPTION_MESSAGES_SHOWN,_||0,!1),l=this._updateInvalidTracker(n.InvalidComponentTracker._OPTION_MESSAGES_HIDDEN,_||0,!1)||l,this._updateInvalidProperties())}return l},n.InvalidComponentTracker.prototype._initializeInvalidTrackers=function(e,i){void 0===this._invalid[e]&&this._updateInvalidTracker(n.InvalidComponentTracker._OPTION_MESSAGES_SHOWN,e,i),void 0===this._invalidHidden[e]&&this._updateInvalidTracker(n.InvalidComponentTracker._OPTION_MESSAGES_HIDDEN,e,i)},n.InvalidComponentTracker.prototype._updateInvalidProperties=function(){this.invalidShown=this._invalid.indexOf(!0)>=0,this.invalidHidden=this._invalidHidden.indexOf(!0)>=0},n.InvalidComponentTracker.prototype._updateInvalidTracker=function(e,i,a){var t,o=!1;return t=e===n.InvalidComponentTracker._OPTION_MESSAGES_SHOWN?this._invalid:e===n.InvalidComponentTracker._OPTION_MESSAGES_HIDDEN?this._invalidHidden:[],i>=0&&void 0!==t[i]?(o=t[i]!==a)&&(t[i]=a):(t.push(a),o=!0),o},n.InvalidComponentTracker._hasInvalidMessages=function(n){return!t.isValid(n)},n.ValueBinding=function(){},n.ValueBinding._ATTRIBUTE_INVALID_COMPONENT_TRACKER="invalidComponentTracker",n.ValueBinding._EVENT_OPTIONCHANGE="ojoptionchange",n.ValueBinding._OPTION_MESSAGES_SHOWN="messagesShown",n.ValueBinding._OPTION_MESSAGES_HIDDEN="messagesHidden",n.ValueBinding._OPTION_DISABLED="disabled",n.ValueBinding._OPTION_READONLY="readOnly",n.ValueBinding._update=function(e,i,t,o,r){var d={},l=r.call()[n.ValueBinding._ATTRIBUTE_INVALID_COMPONENT_TRACKER];if(e===n.ValueBinding._OPTION_DISABLED||e===n.ValueBinding._OPTION_READONLY){var _=l&&l.peek()||null;return null!==_&&a.isWriteableObservable(l)&&_._update.call(_,o,t,e,i)&&l.valueHasMutated(),d[e]=i,d}},n.ValueBinding._init=function(n,e){var i={};return i[n]=e,i},n.ValueBinding._afterCreate=function(e,i,a,t){var o=t.call();return e===n.ValueBinding._ATTRIBUTE_INVALID_COMPONENT_TRACKER&&!!o[e]&&n.ValueBinding._registerInvalidComponentTrackerWriteback(e,o,i,a),{}},n.ValueBinding._beforeDestroy=function(i,t,o,r){var d,l=e(t),_=r.call()[i];i===n.ValueBinding._ATTRIBUTE_INVALID_COMPONENT_TRACKER&&(l.off(n.ValueBinding._EVENT_OPTIONCHANGE,n.ValueBinding._updateInvalidComponentTracker),_&&a.isWriteableObservable(_)&&(d=_.peek())._remove.call(d,o)&&_.valueHasMutated())},n.ValueBinding._updateInvalidComponentTracker=function(e){var i,t=e.data.tracker,o=e.data.component,r=e.data.element,d=arguments[1],l=d.option,_=d.value;l!==n.ValueBinding._OPTION_MESSAGES_SHOWN&&l!==n.ValueBinding._OPTION_MESSAGES_HIDDEN||t&&a.isWriteableObservable(t)&&(i=t.peek())&&i._update.call(i,o,r,l,_)&&t.valueHasMutated()},n.ValueBinding._registerInvalidComponentTrackerWriteback=function(i,t,o,r){var d,l=t[i],_=e(o);if(!a.isObservable(l))throw new Error("Binding attribute "+n.ValueBinding._ATTRIBUTE_INVALID_COMPONENT_TRACKER+" should be bound to a ko observable.");if(null==(d=l.peek())&&l(d=new n.InvalidComponentTracker),a.isWriteableObservable(l)){var s=r.call(r,"option",n.ValueBinding._OPTION_MESSAGES_SHOWN),u=r.call(r,"option",n.ValueBinding._OPTION_MESSAGES_HIDDEN);d._update.call(d,r,o,n.ValueBinding._OPTION_MESSAGES_SHOWN,s),d._update.call(d,r,o,n.ValueBinding._OPTION_MESSAGES_HIDDEN,u),l.valueHasMutated()}var c={tracker:l,component:r,element:o};_.on(n.ValueBinding._EVENT_OPTIONCHANGE,c,n.ValueBinding._updateInvalidComponentTracker)},n.ComponentBinding.getDefaultInstance().setupManagedAttributes({for:"editableValue",attributes:[n.ValueBinding._ATTRIBUTE_INVALID_COMPONENT_TRACKER,n.ValueBinding._OPTION_DISABLED,n.ValueBinding._OPTION_READONLY],init:n.ValueBinding._init,update:n.ValueBinding._update,afterCreate:n.ValueBinding._afterCreate,beforeDestroy:n.ValueBinding._beforeDestroy})});