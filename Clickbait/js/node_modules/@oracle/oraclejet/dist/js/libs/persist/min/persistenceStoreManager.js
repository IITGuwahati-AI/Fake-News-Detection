define(["./impl/logger"],function(a){"use strict";var b=function(){Object.defineProperty(this,"_stores",{value:{},writable:!0}),Object.defineProperty(this,"_factories",{value:{},writable:!0}),Object.defineProperty(this,"_DEFAULT_STORE_FACTORY_NAME",{value:"_defaultFactory",writable:!1}),Object.defineProperty(this,"_storeNameMapping",{value:{},writable:!0})};return b.prototype.registerStoreFactory=function(a,b){if(!b)throw TypeError("A valid factory must be provided.");if(!a)throw TypeError("A valid name must be provided.");var c=this._mapStoreName(a),d=this._factories[c];if(d&&d!==b)throw TypeError("A factory with the same name has already been registered.");this._factories[c]=b},b.prototype.registerDefaultStoreFactory=function(a){this.registerStoreFactory(this._DEFAULT_STORE_FACTORY_NAME,a)},b.prototype.openStore=function(b,c){a.log("Offline Persistence Toolkit PersistenceStoreManager: openStore() for name: "+b);var d=this._mapStoreName(b),e=this._stores[d],f=c&&c.version||"0";if(e&&e[f])return Promise.resolve(e[f]);var g=this._factories[d];if(g||(g=this._factories[this._DEFAULT_STORE_FACTORY_NAME]),!g)return Promise.reject(new Error("no factory is registered to create the store."));var h=this;return a.log("Offline Persistence Toolkit PersistenceStoreManager: Calling createPersistenceStore on factory"),g.createPersistenceStore(d,c).then(function(a){return e=e||{},e[f]=a,h._stores[d]=e,a})},b.prototype.hasStore=function(a,b){var c=this._mapStoreName(a),d=this._stores[c];return!!d&&(!b||!b.version||!!d[b.version])},b.prototype.deleteStore=function(b,c){a.log("Offline Persistence Toolkit PersistenceStoreManager: deleteStore() for name: "+b);var d=this._mapStoreName(b),e=this._stores[d];if(e){var f=c&&c.version;if(f){var g=e[f];return g?(a.log("Offline Persistence Toolkit PersistenceStoreManager: Calling delete on store"),g.delete().then(function(){return delete e[f],!0})):Promise.resolve(!1)}var h=function(a){return function(b){var c=a[b];return c.delete()}},i=Object.keys(e).map(h(e),this),j=this;return Promise.all(i).then(function(){return delete j._stores[d],!0})}return Promise.resolve(!1)},b.prototype._mapStoreName=function(a,b){var c=this._storeNameMapping[a];return c?c:(c=a.replace(/(.*):\/\/(.*)/gi,"$1$2"),this._storeNameMapping[a]=c,c)},new b});