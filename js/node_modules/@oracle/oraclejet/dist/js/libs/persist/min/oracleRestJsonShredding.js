define(["./persistenceUtils","./impl/logger"],function(a,b){"use strict";function c(a,b){if(!a||1!==a.length)throw new Error({message:"shredded data is not in the correct format."});var c,d=a[0].data;return c=d&&1===d.length&&"single"===a[0].resourceType?d[0]:{items:d,count:d.length}}var d=function(a,c){return function(d){b.log("Offline Persistence Toolkit oracleRestJsonShredding: Shredding Response");var e=d.clone(),f=e.headers.get("X-ORACLE-DMS-ECID");return e.text().then(function(d){var e=[],g=[],h="collection";if(null!=d&&d.length>0)try{var i=JSON.parse(d);if(null!=i.items)e=i.items.map(function(a){if(c instanceof Array){var b=[];return c.forEach(function(c){b.push(a[c])}),b}return a[c]}),g=i.items;else{if(c instanceof Array){var j=[];c.forEach(function(a){j.push(i[a])}),e[0]=j}else e[0]=i[c];g[0]=i,h="single"}}catch(a){b.log("Offline Persistence Toolkit oracleRestJsonShredding: Error during shredding: "+a)}return[{name:a,resourceIdentifier:f,keys:e,data:g,resourceType:h}]})}},e=function(){return function(d,e){b.log("Offline Persistence Toolkit oracleRestJsonShredding: Unshredding Response");var f=c(d,e);return a.setResponsePayload(e,f).then(function(a){return a.headers.set("x-oracle-jscpt-cache-expiration-date",""),a})}};return{getShredder:d,getUnshredder:e}});